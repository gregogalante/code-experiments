# Base image (https://hub.docker.com/r/library/ruby/)
FROM ruby:latest
MAINTAINER Gregorio Galante <gregogalante@gmail.com>

# Create and set work directory.
ENV HOME /home/rails/application
WORKDIR $HOME

# Install dependencies and js engine.
RUN apt-get update -qq && apt-get install -y build-essential redis-server nodejs

# Copy the source code from project to the image.
ADD . $HOME

# Set important environment variables.
ENV RAILS_ENV development
ENV SECRET_KEY_BASE update_me_please

# Install gems.
RUN bundle install

# Initialize application.
RUN rails db:migrate
RUN rails assets:precompile

# Run server.
CMD rails server --binding 0.0.0.0
